---
title: "lab_04_update"
author: "Rob Wells/Derek Willis"
date: "2025-10-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## About this lab

To complete this lab, you need to: \* run existing code as directed (look for **Task**). \* modify existing code as directed (look for **Task**). \* write code in empty codeblocks provided to answer questions included (look for **Q**). \* write out the answer in the form of a complete sentence in the space given (look for **A**).

When you are finished, commit changes and push to your personal GitHub repo, then submit the URL to this document on ELMS.

## Load libraries and establish settings

You'll need to load three packages for this: the tidyverse, lubridate, refinr and janitor.

**Task** load these four packages.

```{r}
# Turn off scientific notation
options(scipen=999)

# load your packages
library(tidyverse)
library(janitor)
library(lubridate)
library(refinr)

```

For this lab, we want to investigate spending by Maryland state and local candidates during the 2022 election. For example, we could ask how much money have candidates and committees spent on advertising on Facebook? Which vendors received the most money for media expenses? We have the data, but it's messy - names of payees are spelled differently and capitalized differently - and we need to clean it up. 


## Load Data

You'll need to load one data set, a CSV file of Maryland campaign expenditures located in the data folder called "maryland_expenses.csv"

**Task** Create a codeblock below, then read the data in and assign it to an appropriate variable name. 
--Use janitor to clean the column names
--Clean dates and make them into datatypes.

```{r}
# Load the Maryland expenditures data table

expenses <- read_csv("data/maryland_expenses.csv") |> 
  clean_names() |> 
  mutate(date = mdy(expenditure_date))
```

## Answer questions

**Q1.** You've been assigned to write about Maryland political committees' use of Facebook advertising. There's a category column in the data that has values for different kinds of spending. One of them is "Media". You'll need to complete the following steps:

1.  Create a dataframe filtered for just Media expenses.
2.  Create a `payee_clean` column and standardize the data from `payee_name` using the `n_gram_merge' command

**A1:**

```{r}
expenses_cleaned <- expenses |>
   filter(expense_category == "Media") |> 
  mutate(payee_clean=n_gram_merge(payee_name))
 
```





**Q2** More cleaning of Facebook. Look carefully at variations of Facebook, bearing in mind that it changed its name in 2021: <https://about.fb.com/news/2021/10/facebook-company-is-now-meta/>).

#This code may help you search by wildcard and detect the variants
```{r}
#Starter code to search by wildcard and group together the variants
**YOUR_CLEANED_EXPENSE_DATAFRAME_NAME** |> 
  filter(str_detect(payee_name, regex("facebook", ignore_case = TRUE))) |>
  filter(str_detect(payee_name, regex("OTHER SEARCH TERMS!", ignore_case = TRUE))) |>
  count(payee_name, sort = TRUE)

```

Create a new object called `expenses_summary` 
Using case_when, create a column called `payee_FB` that will standardize all the variations on Facebook and **its parent company** in the data. 
Filter the data in `payee_FB` for all of the standardized Facebook items.
Then calculate the total amount of Facebook spending by each committee and present the results showing the committee that spent the most first.

**A**: YOUR CODE HERE
```{r}
expenses_summary <- expenses_cleaned |> 
  mutate(payee_FB = case_when(
             str_detect(payee_clean, regex("meta", ignore_case = TRUE)) ~ "Facebook",
                       .default = payee_clean)) |>
  filter(payee_FB == "Facebook") |> 
    group_by(committee_name) |>
  summarise(total = sum(amount)) |> 
  arrange(desc(total))
  

```


**Q3.** Let's do some research on the top committees from question 1. Look up the top 10 spenders: if they are candidate committees, what offices were they running for? 


**A3.**



**Q4.** Given the list of top spenders and the primary results for governor (<https://elections.maryland.gov/elections/2022/primary_results/gen_results_2022_1.html>), who is missing from that list? 



**a.** Who are the biggest recipients of media expenses by the Democratic primary winner for governor? Hint: that person has two committees, the second one with his running mate.

** WRITE THE ANSWER**

**b.** Describe the business of the top recipient.
** WRITE THE ANSWER**

**A4.** 

Who is missing from that list?
Wes Moore and Dan Cox are missing from the list of Facebook spenders.

Describe the business of the top recipient.

SKDK is a campaign consulting firm. "SKDK brings unparalleled strategic communications experience to Fortune 500 companies, non-profits, philanthropic organizations, labor unions, and political committees and candidates."

**A**: YOUR CODE HERE
```{r}
expenses_cleaned |> 
  filter(committee_name == 'Moore  Wes For Maryland' | committee_name == 'Moore Miller For Maryland Slate') |> 
  filter(expense_category == "Media") |>
  group_by(payee_name) |> 
   summarise(total = sum(amount)) |> 
  arrange(desc(total))
  

```

**Q5.** The media expense data you cleaned also has a standardized purpose column. Write code to generate a list of the committees with the total amount of spending on online advertising. How does this list compare to the one from Q1 about top Facebook spenders? Of the top 5 committees who spent the most on Facebook ads from Q1, are there any that appear to have spent *all* of their online advertising dollars on Facebook?

**A5.**
This list has larger amounts for total online ad spending, and a varied list of top committees, including Calvin Ball (Howard County exec candidate) and the House Democratic Caucus. Ashwani Jain, the top committee on the Facebook spending list, appears to have spent all of its online advertising dollars on Facebook.

**A**: YOUR CODE HERE
```{r}
expenses |> 
  filter(expense_purpose == 'Online Advertising') |> 
  group_by(committee_name) |> 
  summarise(total_amount = sum(amount)) |> 
  arrange(desc(total_amount))
```

**Q6** Your editor asks you to summarize your findings about spending on Facebook by Maryland political candidates. How much do we know and what don't we know? What's the best story idea you've found here?

**A6**
